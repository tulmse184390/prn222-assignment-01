@model BLL.BusinessObjects.ViewCreateTestDriveAppointment
@{
    ViewBag.Title = "Tạo lịch hẹn lái thử";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-wrapper">
    <!-- Cột trái: Form tạo lịch -->
    <div class="left-column">
        <div class="form-container">
            <h2>➕ Tạo lịch hẹn lái thử</h2>
            <form method="post" onsubmit="return validateForm()">
                <div class="form-group">
                    <label for="CustomerId">Khách hàng</label>
                    <select id="CustomerId" name="CustomerId" class="form-control">
                        @foreach (var customer in Model.Customers)
                        {
                            <option value="@customer.CustomerId">@customer.FullName</option>
                        }
)
                    </select>
                </div>

                <!-- Hidden để lưu xe được chọn -->
                <input type="hidden" id="CarVersionId" name="CarVersionId" />
                <input type="hidden" id="ColorId" name="ColorId" />

                <div class="form-group">
                    <label for="DateTime">Ngày giờ</label>
                    <input id="DateTime" name="DateTime" type="datetime-local" class="form-control" />
                </div>

                <div class="form-group">
                    <label for="Feedback">Ghi chú</label>
                    <textarea id="Feedback" name="Feedback" class="form-control"></textarea>
                </div>

                <button type="submit" class="btn-submit">Lưu lịch hẹn</button>
                <a href="/TestDriveAppointments/Index" class="btn-cancel">Hủy</a>
            </form>
        </div>
    </div>

    <!-- Cột phải: Danh sách xe -->
    <div class="right-column">
        <div class="car-list">
            <h3>🚗 Xe có sẵn (chọn 1 xe)</h3>

            <!-- Thanh tìm kiếm -->
            <div class="form-group">
                <input type="text" id="searchCar" class="form-control" placeholder="🔍 Tìm xe theo tên hoặc màu..." />
            </div>

            <table class="table-cars" id="carTable">
                <thead>
                    <tr>
                        <th>Chọn</th>
                        <th>Xe</th>
                        <th>Màu</th>
                        <th>Số lượng</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="radio" name="selectCar" value="1-1" /></td>
                        <td>VinFast VF 8</td>
                        <td>Đỏ</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td><input type="radio" name="selectCar" value="2-2" /></td>
                        <td>VinFast VF 9</td>
                        <td>Trắng</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td><input type="radio" name="selectCar" value="3-3" /></td>
                        <td>VinFast VF 6</td>
                        <td>Đen</td>
                        <td>2</td>
                    </tr>
                    @foreach (var car in Model.Inventory)
                    {
                        <tr>
                            <td><input type="radio" name="selectCar" value="@($"{car.VersionId}-{car.ColorId}")" /></td>
                            <td>@car.Version.VersionName - @car.Version.Model.ModelName</td>
                            <td>@car.Color.ColorName</td>
                            <td>@car.Quantity</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .page-wrapper {
        display: flex;
        gap: 20px;
        padding: 20px;
    }

    .left-column {
        flex: 1;
    }

    .right-column {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .form-container, .car-list {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        font-weight: 500;
        margin-bottom: 5px;
        display: block;
    }

    .form-control {
        width: 100%;
        padding: 8px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
    }

    .btn-submit {
        background: #3b82f6;
        color: #fff;
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

        .btn-submit:hover {
            background: #2563eb;
        }

    .btn-cancel {
        margin-left: 10px;
        text-decoration: none;
        padding: 8px 14px;
        border-radius: 6px;
        background: #e2e8f0;
        color: #1e293b;
    }

        .btn-cancel:hover {
            background: #cbd5e1;
        }

    .table-cars {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

        .table-cars th, .table-cars td {
            border-bottom: 1px solid #e2e8f0;
            padding: 6px;
            text-align: left;
        }

        .table-cars tr.selected {
            background: #dbeafe;
        }
</style>

<script>
    // Xử lý chọn xe
    document.querySelectorAll("input[name='selectCar']").forEach(radio => {
        radio.addEventListener("change", function () {
            const [carVersionId, colorId] = this.value.split("-");
            document.getElementById("CarVersionId").value = carVersionId;
            document.getElementById("ColorId").value = colorId;

            // Highlight dòng đã chọn
            document.querySelectorAll("#carTable tbody tr").forEach(tr => tr.classList.remove("selected"));
            this.closest("tr").classList.add("selected");
        });
    });

        function validateForm() {
        const carVersionId = document.getElementById("CarVersionId").value;
        const colorId = document.getElementById("ColorId").value;
        const dateTime = document.getElementById("DateTime").value;

        if (!carVersionId || !colorId) {
            alert("⚠️ Vui lòng chọn xe trước khi lưu lịch hẹn!");
            return false; // chặn submit
        }

        if (!dateTime) {
            alert("⚠️ Vui lòng chọn ngày giờ trước khi lưu lịch hẹn!");
            return false; // chặn submit
        }

        return true; // cho phép submit
    }

    // Tìm kiếm xe
    document.getElementById("searchCar").addEventListener("keyup", function () {
        const keyword = this.value.toLowerCase();
        document.querySelectorAll("#carTable tbody tr").forEach(row => {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(keyword) ? "" : "none";
        });
    });
</script>
