@model BLL.BusinessObjects.ViewConfirmOrder
@{
    ViewBag.Title = "Xác nhận đơn hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .oc-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 16px;
        color: #0f172a;
    }

    .oc-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 16px;
    }

    .oc-panel {
        background: #fff;
        border-radius: 10px;
        padding: 16px;
        box-shadow: 0 4px 14px rgba(15,23,42,0.06);
        margin-bottom: 18px;
    }

        .oc-panel h3 {
            margin: 0 0 12px 0;
            font-size: 18px;
            font-weight: 600;
        }

    .oc-info p {
        margin: 4px 0;
        font-size: 14px;
    }

    .oc-table {
        width: 100%;
        border-collapse: collapse;
    }

        .oc-table th {
            background: #f1f5f9;
            padding: 8px 10px;
            text-align: left;
            font-size: 13px;
        }

        .oc-table td {
            padding: 8px 10px;
            border-top: 1px solid #e2e8f0;
            font-size: 14px;
        }

    .oc-total {
        text-align: right;
        font-weight: 600;
        font-size: 15px;
        margin-top: 12px;
    }

    .oc-actions {
        margin-top: 20px;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }

    .oc-btn {
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        text-decoration: none;
        display: inline-block;
    }

    .oc-btn-pay {
        background: #16a34a;
        color: #fff;
    }

        .oc-btn-pay:hover {
            background: #15803d;
        }

    .oc-btn-cancel {
        background: #dc2626;
        color: #fff;
    }

        .oc-btn-cancel:hover {
            background: #b91c1c;
        }

    .oc-btn-edit {
        background: #2563eb;
        color: #fff;
    }

        .oc-btn-edit:hover {
            background: #1d4ed8;
        }
</style>

<div class="oc-container">
    <h2 class="oc-title">Xác nhận đơn hàng</h2>

    <!-- Thông tin chung -->
    <div class="oc-panel">
        <h3>Thông tin chung</h3>
        <div class="oc-info">
            <p><strong>Mã đơn hàng:</strong> #@Model.OrderId</p>
            <p><strong>Nhân viên:</strong> @Model.StaffName</p>
            <p><strong>Khách hàng:</strong> @Model.CustomerName</p>
            <p><strong>Ngày tạo:</strong> @Model.OrderDate.Value.ToString("dd/MM/yyyy")</p>
            <p><strong>Trạng thái:</strong> @Model.Status</p>
        </div>
    </div>

    <!-- Chi tiết xe -->
    <div class="oc-panel">
        <h3>Chi tiết xe</h3>
        <table class="oc-table">
            <thead>
                <tr>
                    <th>Xe</th>
                    <th>Màu</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var d in Model.ViewOrderDetails)
                {
                    <tr>
                        <td>@d.ModelName - @d.VersionName</td>
                        <td>@d.ColorName</td>
                        <td>@d.Quantity</td>
                        <td>@d.UnitPrice.ToString("N0")</td>
                        <td>@d.FinalPrice.ToString("N0")</td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="oc-total">Tổng tiền: @Model.TotalAmount.ToString("N0")</div>
    </div>

    <!-- Nút thao tác -->
    @if (Model.Status == "Pending")
    {
        <div class="oc-actions">
        <!-- Nút Thanh toán (Confirm) -->
            <form asp-action="ChangeStatus" asp-controller="Orders" method="post" style="display:inline;" class="change-status-form">
            <input type="hidden" name="OrderId" value="@Model.OrderId" />
            <input type="hidden" name="Status" value="Confirmed" />
            <button type="submit" class="oc-btn oc-btn-pay">💳 Thanh toán</button>
        </form>

        <!-- Nút Hủy -->
            <form asp-action="ChangeStatus" asp-controller="Orders" method="post" style="display:inline;" class="change-status-form">
            <input type="hidden" name="OrderId" value="@Model.OrderId" />
            <input type="hidden" name="Status" value="Cancelled" />
            <button type="submit" class="oc-btn oc-btn-cancel">✖ Hủy</button>
        </form>

            <!-- Nút Xóa -->
            <form asp-action="Delete" asp-controller="Orders" method="post" style="display:inline;" onsubmit="return confirm('Bạn có chắc chắn muốn xóa đơn hàng này không?');">
                <input type="hidden" name="id" value="@Model.OrderId" />
                <button type="submit" class="oc-btn oc-btn-cancel">🗑 Xóa</button>
            </form>
    </div>
    }
</div>

<script>
            document.addEventListener("DOMContentLoaded", function () {
        const forms = document.querySelectorAll(".change-status-form");
        forms.forEach(form => {
            form.addEventListener("submit", function (e) {
                const status = form.getAttribute("data-status");
                let message = status === "Confirmed"
                    ? "Bạn có chắc chắn muốn xác nhận đơn hàng này không?"
                    : "Bạn có chắc chắn muốn hủy đơn hàng này không?";

                if (!confirm(message)) {
                    e.preventDefault(); // chặn submit nếu bấm Cancel
                }
            });
        });
    });
</script>